name: JQ Environment Variable Example

on:
  workflow_dispatch:

jobs:
  test-jq-env:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Test jq with environment variables
        env:
          # Set your GitHub Copilot API token here
          # For testing purposes, you can use GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_COPILOT_API_TOKEN: ${{ secrets.GITHUB_COPILOT_API_TOKEN }}
        run: |
          echo "Testing jq env access..."
          
          # Test accessing env object
          echo "All environment variables:"
          jq -n 'env | keys | sort' | head -20
          
          # Test accessing specific variable
          echo ""
          echo "Accessing GITHUB_COPILOT_API_TOKEN:"
          TOKEN=$(jq -n -r 'env.GITHUB_COPILOT_API_TOKEN // ""')
          if [ -n "$TOKEN" ]; then
            echo "✓ GITHUB_COPILOT_API_TOKEN is set (value hidden for security)"
            echo "Token length: ${#TOKEN} characters"
          else
            echo "⚠ GITHUB_COPILOT_API_TOKEN is not set"
            echo "Please configure the GITHUB_COPILOT_API_TOKEN secret in your repository"
            echo "For testing, you can add this to your workflow file's env section:"
            echo "  GITHUB_COPILOT_API_TOKEN: \${{ secrets.GITHUB_TOKEN }}"
          fi
          
          # Test with other environment variables
          echo ""
          echo "Testing other env variables:"
          jq -n '{
            workspace: env.GITHUB_WORKSPACE,
            ref: env.GITHUB_REF,
            token_exists: (env.GITHUB_COPILOT_API_TOKEN != null)
          }'
